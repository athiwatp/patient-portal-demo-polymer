<html><head><link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-resizable-behavior/iron-resizable-behavior.html">
<link rel="import" href="vaadin-grid-active-item-behavior.html">
<link rel="import" href="vaadin-grid-table-scroll-behavior.html">
<link rel="import" href="vaadin-grid-sizer.html">
<link rel="import" href="vaadin-grid-table-outer-scroller.html">
<link rel="import" href="vaadin-grid-table-header-footer.html">
<link rel="import" href="vaadin-grid-table-cell.html">
<link rel="import" href="vaadin-grid-table-row.html">
<link rel="import" href="vaadin-grid-row-details-behavior.html">
<link rel="import" href="vaadin-grid-data-source-behavior.html">
<link rel="import" href="vaadin-grid-selection-behavior.html">
<link rel="import" href="vaadin-grid-keyboard-navigation-behavior.html">
<link rel="import" href="vaadin-grid-column-reordering-behavior.html">
<link rel="import" href="iron-list-behavior.html">

</head><body><dom-module id="vaadin-grid-table-styles">
  <template>
    <style>

      @keyframes appear {
        to {
          opacity: 1;
        }
      }

      :host {
        display: block;
        position: relative;
        animation: 0 appear;
      }

      @media only screen and (-webkit-max-device-pixel-ratio: 1) {
        :host {
          will-change: transform;
        }
      }

      #items {
        position: relative;
      }

      #items,
      #fixedsizer,
      #outersizer {
        border-top: 0 solid transparent;
        border-bottom: 0 solid transparent;
      }

      :host(:not([grid])) #items > ::content > * {
        width: 100%;
      }

      #items > tr {
        box-sizing: border-box;
        margin: 0;
        position: absolute;
        /* iron-list expects top to be 0. Might cause issues */
        /* top: 0; */
        will-change: transform;
      }

      table {
        height: 100%;
        width: 100%;
        display: block;
        overflow: auto;
        box-sizing: border-box;
      }

      [overflow-hidden] {
        overflow: hidden;
      }

      tbody {
        display: block;
      }

      thead th,
      tfoot td {
        top: 0;
      }

      .vaadin-grid-cell {
        padding: 0;
        flex-shrink: 0;
        flex-grow: 1;
        box-sizing: border-box;
        display: flex;
      }

      .vaadin-grid-cell:not([detailscell]) {
        position: relative;
      }

      .vaadin-grid-cell ::content > .cell-content {
         width: 100%;
         display: inline-flex;
         justify-content: center;
         flex-direction: column;
         white-space: nowrap;
         overflow: hidden;
      }

      .vaadin-grid-column-resize-handle {
        position: absolute;
        right: 0;
        height: 100%;
        cursor: col-resize;
        z-index: 1;
      }

      .vaadin-grid-column-resize-handle::before {
        position: absolute;
        content: "";
        height: 100%;
        width: 35px;
        transform: translateX(-50%);
      }

      [lastcolumn] .vaadin-grid-column-resize-handle::before,
      [last-frozen] .vaadin-grid-column-resize-handle::before {
        width: 18px;
        transform: translateX(-100%);
      }

      :host([column-resizing]) {
        -ms-user-select: none;
        -moz-user-select: none;
        -webkit-user-select: none;
        user-select: none;
        cursor: col-resize;
      }

      :host([ios][column-resizing]) #outerscroller {
        overflow: hidden;
      }

      tr:not([hidden]) {
        display: flex;
        width: 100%;
      }

      [frozen] {
        z-index: 2;
      }

      [hidden] {
        display: none;
      }

      caption {
        position: absolute;
        display: block;
        padding: 0;
        width: 100%;
        z-index: -100;
      }

      ::content > vaadin-grid-column,
      ::content > vaadin-grid-selection-column,
      ::content > vaadin-grid-column-group {
        display: none;
      }

      /* Style overrides required to make copying the selection to clipboard work properly (on Safari) */
      :host([copying]) tr {
        opacity: 0 !important;
        position: static !important;
        display: table-row !important;
      }

      :host([copying]) .vaadin-grid-cell {
        display: table-cell !important;
      }
    </style>
  </template>
</dom-module>

<dom-module id="vaadin-grid-table-themability-styles">
  <template>
    <style>

      /* Default borders */

      thead tr:last-child th ::content > .cell-content {
        border-bottom: 1px solid var(--divider-color, rgba(0, 0, 0, 0.08));
      }

      tfoot tr:first-child td ::content > .cell-content {
        border-top: 1px solid var(--divider-color, rgba(0, 0, 0, 0.08));
      }

      tbody tr:not([lastrow]) td ::content > .cell-content {
        border-bottom: 1px solid var(--divider-color, rgba(0, 0, 0, 0.08));
      }

      [last-frozen] ::content > .cell-content {
        border-right: 1px solid var(--divider-color, rgba(0, 0, 0, 0.08));
      }

      /* Column resize handle */

      .vaadin-grid-column-resize-handle {
        border-right: 1px solid var(--divider-color, rgba(0, 0, 0, 0.08));
        @apply(--vaadin-grid-column-resize-handle);
      }

      /* Cells */

      table tr .vaadin-grid-cell:not([detailscell]) ::content > .cell-content {
        background: #fff;
        text-align: left;
        padding: 8px;
        box-sizing: border-box;
        @apply(--vaadin-grid-cell);
      }

      table thead .vaadin-grid-cell:not([detailscell]) ::content > .cell-content {
        font-weight: 500;
        @apply(--vaadin-grid-header-cell);
      }

      table tfoot .vaadin-grid-cell:not([detailscell]) ::content > .cell-content {
        font-weight: 500;
        @apply(--vaadin-grid-footer-cell);
      }

      table tbody .vaadin-grid-cell:not([detailscell]) ::content > .cell-content {
        @apply(--vaadin-grid-body-cell);
      }

      tbody [odd] .vaadin-grid-cell:not([detailscell]) ::content > .cell-content {
        @apply(--vaadin-grid-body-row-odd-cell);
      }

      table tr .vaadin-grid-cell:not([detailscell])[last-frozen] ::content > .cell-content {
        @apply(--vaadin-grid-cell-last-frozen);
      }

      :host(:not([scrolling])) tbody tr:hover .vaadin-grid-cell ::content > .cell-content {
        @apply(--vaadin-grid-body-row-hover-cell);
      }

      table tr .vaadin-grid-cell.vaadin-grid-cell[lastcolumn] ::content > .cell-content {
        border-right: none;
      }

    </style>
  </template>
</dom-module>

<dom-module id="vaadin-grid-table">
  <template>
    <style include="vaadin-grid-table-scroll-styles"></style>
    <style include="vaadin-grid-row-details-styles"></style>
    <style include="vaadin-grid-data-source-styles"></style>
    <style include="vaadin-grid-table-styles"></style>

    <style include="vaadin-grid-table-themability-styles"></style>
    <style include="vaadin-grid-selection-themability-styles"></style>
    <style include="vaadin-grid-navigation-themability-styles"></style>
    <style include="vaadin-grid-active-item-themability-styles"></style>
    <style include="vaadin-grid-data-source-themability-styles"></style>
    <style include="vaadin-grid-row-details-themability-styles"></style>
    <style include="vaadin-grid-column-reordering-themability-styles"></style>


    <!-- trap needs to have content in order for Safari to scroll the page when focused -->
    <div id="headerFocusTrap" tabindex="0" on-focus="_onHeaderFocus" style="position: absolute;z-index: -1">&nbsp;</div>
    <div id="bodyFocusTrap" tabindex="-1" on-focus="_onBodyFocus" style="position: absolute;z-index: -1">&nbsp;</div>

    <content select="vaadin-grid-column, vaadin-grid-selection-column, vaadin-grid-column-group"></content>

    <div id="spinner"></div>
    <table id="table" overflow-hidden$="[[_hideTableOverflow(scrollbarWidth, safari)]]">
      <caption>
        <div id="fixedsizer" is="vaadin-grid-sizer" top="[[_estScrollHeight]]" column-tree="[[columnTree]]">
        </div>
      </caption>
      <thead id="header" target="[[target]]" is="vaadin-grid-table-header" column-tree="[[columnTree]]"></thead>
      <tbody id="items" is="vaadin-grid-table-body"></tbody>
      <tfoot id="footer" target="[[target]]" is="vaadin-grid-table-footer" column-tree="[[columnTree]]"></tfoot>
    </table>

    <vaadin-grid-table-outer-scroller id="outerscroller" scroll-target="[[scrollTarget]]" overflow-hidden$="[[_hideOuterScroller(scrollbarWidth, safari)]]" ios$="[[ios]]" scrolling$="[[scrolling]]">
      <div id="outersizer" is="vaadin-grid-sizer" top="[[_estScrollHeight]]" column-tree="[[columnTree]]"></div>
    </vaadin-grid-table-outer-scroller>

    <!--
      in native Shadow, we move the footer focus trap to light DOM.
      It needs to be injected/slotted back inside the shadow root in order to be focusable.
     -->
    <content select="#footerFocusTrap"></content>
    <div id="footerFocusTrap" tabindex="0" on-focus="_onFooterFocus" style="position: absolute;z-index: -1">&nbsp;</div>
  </template>
</dom-module>

<script>Polymer({is:"vaadin-grid-table",behaviors:[vaadin.elements.grid.IronListBehavior,vaadin.elements.grid.TableScrollBehavior,vaadin.elements.grid.TableKeyboardBehavior,vaadin.elements.grid.TableColumnReorderingBehavior,Polymer.Templatizer,Polymer.IronResizableBehavior],properties:{size:Number,columnTree:Array,bindData:Function,rowDetailsTemplate:Object,safari:{value:/^((?!chrome|android).)*safari/i.test(navigator.userAgent)},scrollbarWidth:{value:function(){var e=document.createElement("div");e.style.width="100px",e.style.height="100px",e.style.overflow="scroll",e.style.position="absolute",e.style.top="-9999px",document.body.appendChild(e);var t=e.offsetWidth-e.clientWidth;return document.body.removeChild(e),t}},target:Object},observers:["_columnTreeChanged(columnTree, _physicalItems, _physicalCountVal)","_sizeChanged(size, bindData)","_rowDetailsTemplateChanged(rowDetailsTemplate, _physicalItems, _physicalCountVal)"],listeners:{"property-changed":"_columnPropChanged",copy:"_onCopy",animationend:"_onAnimationEnd",track:"_onTrack"},_onTrack:function(){this.toggleAttribute("column-resizing",this.$.header.querySelector("[column-resizing]"))},_onAnimationEnd:function(e){/appear/.test(e.animationName)&&(this._render(),this._updateHeaderFooterMetrics(),e.stopPropagation())},_columnPropChanged:function(e){"headerTemplate"===e.detail.path&&this.toggleAttribute("has-templates",!0,this.$.header),"footerTemplate"===e.detail.path&&this.toggleAttribute("has-templates",!0,this.$.footer),/frozen|hidden/.test(e.detail.path)&&this._frozenCellsChanged(),"hidden"===e.detail.path&&this.notifyResize()},_onCopy:function(){this.safari&&(this.toggleAttribute("copying",!0),this.async(function(){this.toggleAttribute("copying",!1)},1))},_hideOuterScroller:function(e,t){return 0===e&&!t},_hideTableOverflow:function(e,t){return 0===e&&t},_rowDetailsTemplateChanged:function(e,t){t.forEach(function(t){t.rowDetailsTemplate=e})},_columnTreeChanged:function(e,t,i){this._frozenCellsChanged(),this._hasTemplatesChanged(e),t.forEach(function(t){t.columns=e[e.length-1]}),this._updateHeaderFooterMetrics(),this._updateLastColumn()},_updateLastColumn:function(){Polymer.dom(this.$.table).querySelectorAll("tr").forEach(function(e){e.updateLastColumn()})},_updateHeaderFooterMetrics:function(){Polymer.RenderStatus.afterNextRender(this.$.header,function(){var e=this.$.header.clientHeight+"px",t=this.$.footer.clientHeight+"px";[this.$.outersizer,this.$.fixedsizer,this.$.items].forEach(function(i){i.style.borderTopWidth=e,i.style.borderBottomWidth=t}),this._pendingScrollToScaledIndex&&this.scrollToScaledIndex(this._pendingScrollToScaledIndex)}.bind(this))},_hasTemplatesChanged:function(e){var t=!1,i=!1;e.forEach(function(e){return e.forEach(function(e){t=t||e.headerTemplate,i=i||e.footerTemplate})}),this.toggleAttribute("has-templates",t,this.$.header),this.toggleAttribute("has-templates",i,this.$.footer)},_createPool:function(e){for(var t=new Array(e),i=0;i<e;i++){var a=document.createElement("tr","vaadin-grid-table-row");a.target=this.domHost,t[i]=a,a.setAttribute("hidden",""),Polymer.dom(this.$.items).appendChild(a)}return t},_sizeChanged:function(e){if(this._virtualStart=0,this._physicalTop=0,this._virtualCount=Math.min(e,1e5),this._physicalIndexForKey={},this._firstVisibleIndexVal=null,this._lastVisibleIndexVal=null,this._vidxOffset=0,this._resetScrollPosition(0),!this._physicalItems){var t=25;this._physicalCount=Math.max(1,Math.min(t,this._virtualCount)),this._physicalItems=this._createPool(this._physicalCount),this._physicalSizes=new Array(this._physicalCount)}this._physicalStart=0,this._itemsRendered=!1,this._debounceTemplate(this._render)},_assignModels:function(e){this._virtualIndexToItem=this._virtualIndexToItem||{},this._iterateItems(function(e,t){var i=this._physicalItems[e];i.index&&delete this._virtualIndexToItem[i.index],i.index=t+this._vidxOffset,this._virtualIndexToItem[i.index]=i,i.toggleAttribute("odd",i.index%2),i.toggleAttribute("lastrow",i.index===this.size-1),i.toggleAttribute("hidden",i.index>=this.size),this.bindData(i.index,i)},e)}});</script>
</body></html>