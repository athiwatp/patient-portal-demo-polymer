<html><head><link rel="import" href="../iron-scroll-target-behavior/iron-scroll-target-behavior.html">

</head><body><dom-module id="vaadin-grid-table-scroll-styles">
  <template>
    <style>
      :host {
        transform: translateZ(0);
      }

      thead {
        position: absolute;
        top: 0;
        width: 100%;
      }

      tfoot {
        position: absolute;
        bottom: 0;
        width: 100%;
      }

      tbody {
        z-index: -1;
      }

      table {
        position: relative;
        overflow: auto;
        -webkit-overflow-scrolling: touch;
        z-index: -2;
      }

      :host([ios]) table {
        transform: none;
      }

      :host([fixed-sections]) {
        /* Any value other than ‘none’ for the transform results in the creation of both a stacking context and
        a containing block. The object acts as a containing block for fixed positioned descendants. */
        transform: translateZ(0);
        overflow: hidden;
      }

      :host([fixed-sections]) thead,
      :host([fixed-sections]) tfoot {
        position: fixed;
      }

      :host([fixed-sections]) tbody#items {
        position: fixed;
        width: 100%;
        will-change: transform;
      }

      :host([fixed-sections]) table {
        transform: none;
      }

    </style>
  </template>
</dom-module>

<script>window.vaadin=window.vaadin||{},vaadin.elements=vaadin.elements||{},vaadin.elements.grid=vaadin.elements.grid||{},vaadin.elements.grid.TableScrollBehaviorImpl={properties:{_vidxOffset:{value:0},ios:{value:navigator.userAgent.match(/iP(?:hone|ad;(?: U;)? CPU) OS (\d+)/),reflectToAttribute:!0},fixedSections:{type:Boolean,reflectToAttribute:!0,computed:"_hasFixedSections(scrollbarWidth)"},_frozenCells:{type:Array,value:function(){return[]}},scrolling:{type:Boolean,reflectToAttribute:!0}},listeners:{"table.wheel":"_onWheel"},ready:function(){this.scrollTarget=this.$.table},scrollToScaledIndex:function(t){this._pendingScrollToScaledIndex=null,this.$.items.style.borderTopWidth||(this._pendingScrollToScaledIndex=t),t=Math.min(Math.max(t,0),this.size-1),this.$.table.scrollTop=t/this.size*this.$.table.scrollHeight,this._scrollHandler(),this.scrollToIndex(t-this._vidxOffset),this._vidxOffset+this.lastVisibleIndex===this.size-1&&(this.$.table.scrollTop=this.$.table.scrollHeight-this.$.table.offsetHeight,this._scrollHandler())},_hasFixedSections:function(t){return navigator.userAgent.match(/Edge/)&&0===t},_onWheel:function(t){if(!t.ctrlKey&&!this._hasScrolledAncestor(t.target,t.deltaX,t.deltaY)){var e=this.$.table,i=Math.abs(t.deltaX)+Math.abs(t.deltaY);this._canScroll(e,t.deltaX,t.deltaY)?(t.preventDefault(),e.scrollTop+=t.deltaY,e.scrollLeft+=t.deltaX,this._scrollHandler(),this._ignoreNewWheel=this.debounce("ignore-new-wheel",function(){this._ignoreNewWheel=null},500)):(i<=this._previousMomentum||this._ignoreNewWheel)&&t.preventDefault(),this._previousMomentum=i}},_hasScrolledAncestor:function(t,e,i){return!!this._canScroll(t,e,i)||(!t.hasAttribute("data-cell-content-id")&&t!==this&&t.parentElement?this._hasScrolledAncestor(t.parentElement,e,i):void 0)},_canScroll:function(t,e,i){return i>0&&t.scrollTop<t.scrollHeight-t.offsetHeight||i<0&&t.scrollTop>0||e>0&&t.scrollLeft<t.scrollWidth-t.offsetWidth||e<0&&t.scrollLeft>0},_scrollHandler:function(t){var e,i,s,l,r,o=Math.max(0,Math.min(this._maxScrollTop,this._scrollTop)),n=o-this._scrollPosition,h=this._ratio,a=0,c=this._hiddenContentSize,d=h,_=[];if(this._scrollPosition=o,this._firstVisibleIndexVal=null,this._lastVisibleIndexVal=null,l=this._scrollBottom,r=this._physicalBottom,Math.abs(n)>this._physicalSize)this._physicalTop+=n,a=Math.round(n/this._physicalAverage);else if(n<0){var f=o-this._physicalTop,u=this._virtualStart;for(s=[],i=this._physicalEnd,d=f/c;d<h&&a<this._physicalCount&&u-a>0&&r-this._getPhysicalSizeIncrement(i)>l;)e=this._getPhysicalSizeIncrement(i),d+=e/c,r-=e,s.push(i),a++,i=0===i?this._physicalCount-1:i-1;_=s,a=-a}else if(n>0){var v=r-l,p=this._virtualEnd,m=this._virtualCount-1;for(s=[],i=this._physicalStart,d=v/c;d<h&&a<this._physicalCount&&p+a<m&&this._physicalTop+this._getPhysicalSizeIncrement(i)<o;)e=this._getPhysicalSizeIncrement(i),d+=e/c,this._physicalTop+=e,s.push(i),a++,i=(i+1)%this._physicalCount}this._virtualCount<this.size&&this._adjustVirtualIndexOffset(n),0===a?(r<l||this._physicalTop>o)&&this._increasePoolIfNeeded():(this._virtualStart=this._virtualStart+a,this._physicalStart=this._physicalStart+a,this._update(s,_)),this._translateStationaryElements(),this.hasAttribute("reordering")||(this.scrolling=!0),this.debounce("vaadin-grid-scrolling",function(){this.scrolling=!1,this._reorderRows()},100)},_adjustVirtualIndexOffset:function(t){if(Math.abs(t)>1e4){if(this._noScale)return void(this._noScale=!1);var e=Math.round(this._scrollPosition/this._scrollHeight*1e3)/1e3,i=e*this.size;this._vidxOffset=Math.round(i-e*this._virtualCount),0===this._scrollTop&&this.scrollToIndex(0)}else{var s=this._vidxOffset||0,l=1e3,r=100;0===this._scrollTop?(this._vidxOffset=0,s!==this._vidxOffset&&this.scrollToIndex(0)):this.firstVisibleIndex<l&&this._vidxOffset>0&&(this._vidxOffset-=Math.min(this._vidxOffset,r),this.scrollToIndex(this.firstVisibleIndex+(s-this._vidxOffset)+1),this._noScale=!0);var o=this.size-this._virtualCount;this._scrollTop>=this._maxScrollTop?(this._vidxOffset=o,s!==this._vidxOffset&&this.scrollToIndex(this._virtualCount)):this.firstVisibleIndex>this._virtualCount-l&&this._vidxOffset<o&&(this._vidxOffset+=Math.min(o-this._vidxOffset,r),this.scrollToIndex(this.firstVisibleIndex-(this._vidxOffset-s)),this._noScale=!0)}},_reorderRows:function(){var t=Polymer.dom(this.$.items),e=t.querySelectorAll("tr"),i=this._virtualStart+this._vidxOffset,s=e.length-(e[0].index-i);if(s<e.length/2)for(var l=0;l<s;l++)t.appendChild(e[l]);else for(var r=s;r<e.length;r++)t.insertBefore(e[r],e[0])},_frozenCellsChanged:function(){this.debounce("cache-elements",function(){Polymer.dom(this.root).querySelectorAll("td, th").forEach(function(t){t.style.transform=""}),this._frozenCells=Polymer.dom(this.root).querySelectorAll("[frozen]"),this._translateStationaryElements()}),this._updateLastFrozen()},_updateLastFrozen:function(){var t=this.columnTree[this.columnTree.length-1].slice(0);t.sort(function(t,e){return t._order-e._order});var e=t.reduce(function(t,e,i){return e._lastFrozen=!1,e.frozen&&!e.hidden?i:t},void 0);void 0!==e&&(t[e]._lastFrozen=!0)},_translateStationaryElements:function(){this.fixedSections?(this.$.items.style.transform=this._getTranslate(-this._scrollLeft||0,-this._scrollTop||0),this.$.footer.style.transform=this.$.header.style.transform=this._getTranslate(-this._scrollLeft||0,0)):this.$.footer.style.transform=this.$.header.style.transform=this._getTranslate(0,this._scrollTop);for(var t=this._getTranslate(this._scrollLeft,0),e=0;e<this._frozenCells.length;e++)this._frozenCells[e].style.transform=t},_getTranslate:function(t,e){return"translate("+t+"px,"+e+"px)"}},vaadin.elements.grid.TableScrollBehavior=[Polymer.IronScrollTargetBehavior,vaadin.elements.grid.TableScrollBehaviorImpl];</script>
</body></html>